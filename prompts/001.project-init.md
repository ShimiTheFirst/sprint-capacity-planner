# Project: Sprint Capacity Planner

## Your Role

You are an expert full-stack developer proficient in **Next.js**, **TypeScript**, **Tailwind CSS (v4)**, **shadcn/ui**, and **Zustand**. Your task is to build the "Sprint Capacity Planner" application described below. Prioritize clean, modular, and maintainable code with a good user experience.

## Overall Goal

Build a web application to help a development team manage and visualize their capacity during sprint planning. The main goal is to clearly show how much capacity is taken and remaining for each team member within a sprint.

## Core Technologies

* **Framework:** Next.js 14+ (App Router)
* **Language:** TypeScript
* **Styling:** Tailwind CSS v4 (configure using CSS variables in `app/globals.css`)
* **UI Components:** shadcn/ui (install components as needed using the CLI)
* **State Management:** Zustand
* **Data Storage:** JSON files on the Next.js server (stored in a `data/` directory at the project root).

## Suggested Project Structure

/app
  /(app)
    /team-members/page.tsx
    /sprints/page.tsx
    /sprints/[sprintId]/page.tsx
    /current-sprint/page.tsx
    layout.tsx
  /api
    /members/route.ts
    /members/[memberId]/route.ts
    /sprints/route.ts
    /sprints/[sprintId]/route.ts
    /sprints/[sprintId]/tasks/route.ts
  globals.css
/components
  /ui (for shadcn/ui components)
  /custom (Navigation, MemberCard, SprintForm, etc.)
/data
  members.json
  sprint-[timestamp1].json
/lib
  utils.ts (date calculations, ID generation, etc.)
  hooks.ts
/store
  memberStore.ts
  sprintStore.ts

## Data Models (JSON Structures)

### 1. Team Members (`data/members.json`)

* An array of member objects.
* Each member:
  * `id`: `string` (use `crypto.randomUUID()`)
  * `name`: `string`
  * `emoji`: `string`

    ```json
    // Example: data/members.json
    [
      { "id": "uuid-alice", "name": "Alice", "emoji": "üë©‚Äçüíª" },
      { "id": "uuid-bob", "name": "Bob", "emoji": "üë®‚ÄçüöÄ" }
    ]
    ```

### 2. Sprint (`data/sprint-[createdAtTimestamp].json`)

* One JSON file per sprint.
* Sprint object structure:
  * `sprintId`: `string`
  * `name`: `string`
  * `startDate`: `string` ("YYYY-MM-DD")
  * `endDate`: `string` ("YYYY-MM-DD")
  * `totalWorkingDays`: `number` (Calculated: Number of **weekdays (Mon-Fri)** between `startDate` and `endDate`, inclusive. Implement a helper in `lib/utils.ts` for this).
  * `teamSnapshot`: Array of member capacity objects.
    * Each member:
      * `memberId`: `string`
      * `name`: `string`
      * `emoji`: `string`
      * `maxCapacity`: `number` (Calculated: `totalWorkingDays` \* 8 hours)
      * `filledCapacity`: `number` (Sum of `time` for assigned tasks, default 0)
      * `tasks`: Array of task objects.
        * Each task:
          * `taskId`: `string` (use `crypto.randomUUID()`)
          * `description`: `string`
          * `clientName`: `string`
          * `time`: `number` (in hours)
          * `assignedToMemberId`: `string`

    ```json
    // Example: data/sprint-20250601T090000Z.json
    {
      "sprintId": "sprint-20250601T090000Z",
      "name": "June Sprint Week 1-2",
      "startDate": "2025-06-01",
      "endDate": "2025-06-14",
      "totalWorkingDays": 10, // Example: Assuming 10 working days
      "teamSnapshot": [
        {
          "memberId": "uuid-alice",
          "name": "Alice",
          "emoji": "üë©‚Äçüíª",
          "maxCapacity": 80, // 10 * 8
          "filledCapacity": 8,
          "tasks": [
            { "taskId": "uuid-task1", "description": "Setup project", "clientName": "Internal", "time": 8, "assignedToMemberId": "uuid-alice" }
          ]
        },
        {
          "memberId": "uuid-bob",
          "name": "Bob",
          "emoji": "üë®‚ÄçüöÄ",
          "maxCapacity": 80,
          "filledCapacity": 0,
          "tasks": []
        }
      ]
    }
    ```

## UI Views & Components (Use shadcn/ui)

1. **Navigation (`components/custom/Navigation.tsx`):**
    * Use `NavigationMenu` for links: "Team Members", "Sprints", "Current Sprint".
2. **Team Members Page (`app/(app)/team-members/page.tsx`):**
    * Use `Table` to display members (name, emoji).
    * Include an "Add Member" button (`Button`) opening `MemberFormModal`.
    * Include a remove action (`AlertDialog` for confirmation).
3. **Member Form Modal (`components/custom/MemberFormModal.tsx`):**
    * Use `Dialog` for the modal.
    * Use `Input` for Name and Emoji.
    * Handle creating new members.
4. **Sprints Page (`app/(app)/sprints/page.tsx`):**
    * Use `Card` or `Table` to list sprints (name, dates).
    * Link each sprint to `/sprints/[sprintId]`.
    * Include a "Create New Sprint" button opening `SprintFormModal`.
5. **Sprint Form Modal (`components/custom/SprintFormModal.tsx`):**
    * Use `Dialog`, `Input`, `DatePicker` (`Popover` + `Calendar`), `Button`.
    * On submit, trigger the API to create a new sprint record.
6. **Sprint Detail Page (`app/(app)/sprints/[sprintId]/page.tsx`):**
    * Display sprint info.
    * For each member in `teamSnapshot`:
        * Display Name, Emoji.
        * Show capacity: "20h / 80h".
        * Use `Progress` for visual capacity.
        * List assigned tasks.
        * Include an "Add Task" button opening `TaskFormModal` for that member.
        * Allow editing/deleting tasks.
7. **Task Form Modal (`components/custom/TaskFormModal.tsx`):**
    * Use `Dialog`, `Input`, `Textarea`, `Button`.
    * Capture Description, Client Name, Time.
8. **Current Sprint Page (`app/(app)/current-sprint/page.tsx`):**
    * Identify and display/redirect to the sprint currently active (based on dates).
    * Show a message if no sprint is active.

## State Management (Zustand)

1. **`memberStore.ts`:**
    * Manage `members`, loading/error states.
    * Actions: `fetchMembers`, `addMember`, `removeMember` (calling APIs).
2. **`sprintStore.ts`:**
    * Manage `sprints`, `activeSprint`, loading/error states.
    * Actions: `fetchSprints`, `fetchSprintById`, `createSprint`, `addTaskToSprintMember`, `updateTaskInSprintMember`, `removeTaskFromSprintMember` (calling APIs).
    * Ensure actions update `filledCapacity` and trigger API calls to persist changes.

## API Routes (Next.js Route Handlers)

* Implement API endpoints in `app/api/` to handle **CRUD** (Create, Read, Update, Delete) operations for **members**, **sprints**, and **tasks**.
* **Reading:** Fetch data from the relevant JSON files.
* **Writing:** Read the existing JSON, modify the data, and write the updated data back.
* **Sprint Creation:** Calculate `totalWorkingDays` and `maxCapacity`, copy members into `teamSnapshot`.
* **Task Operations:** When tasks are modified, **recalculate and save** the `filledCapacity` for the affected member in the sprint's JSON file.

## Key Features & Logic

1. **Working Day Calculation:** Ensure the helper function in `lib/utils.ts` correctly calculates the number of **Mondays through Fridays** between two dates, inclusive.
2. **Capacity Calculation:** `maxCapacity = totalWorkingDays * 8`. `filledCapacity` is the sum of task hours.
3. **Task Management:** Allow tasks to be added/edited/deleted. Remember that tasks can also represent **time off or holidays** ‚Äì these will simply be logged with their respective time values, contributing to `filledCapacity`.
4. **Data Persistence:** All changes must be saved back to the appropriate JSON files via API calls.

## Development Steps (Suggested Order)

1. **Setup:** Initialize the project.
2. **Data & APIs:** Define interfaces, build API routes for JSON I/O.
3. **Team Members:** Implement the Team Members UI and state.
4. **Sprints:** Implement the Sprints list and creation UI/state.
5. **Sprint Detail:** Implement the Sprint Detail view (read-only first).
6. **Tasks:** Implement Task CRUD operations and capacity updates (UI, state, API).
7. **Navigation & Current Sprint:** Finalize routing and current sprint logic.
8. **Polish:** Refine UI, add error handling.

## Key Implementation Notes

* Use `crypto.randomUUID()` for all new IDs.
* Use `async/await` for file I/O in API routes.
* Ensure data consistency when updating JSON files.
* Build modular components.
* Adhere to Tailwind v4 best practices.
